<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogicGen - IA para Algoritmos</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Mermaid.js -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
        pre::-webkit-scrollbar { width: 8px; height: 8px; }
        pre::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .mermaid svg { max-width: 100% !important; height: auto !important; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Iconos SVG personalizados para evitar dependencias externas complejas
        const Icons = {
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            GitBranch: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Code: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Alert: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        };

        const apiKey = ""; // Deja vacío para que el usuario pueda usar la suya o inyéctala aquí.

        function App() {
            const [description, setDescription] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [result, setResult] = useState(null);
            const [copied, setCopied] = useState(false);
            const mermaidRef = useRef(null);

            useEffect(() => {
                mermaid.initialize({
                    startOnLoad: false,
                    theme: 'neutral',
                    securityLevel: 'loose',
                    flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' }
                });
            }, []);

            useEffect(() => {
                if (result?.mermaidCode) {
                    const renderDiagram = async () => {
                        try {
                            const { svg } = await mermaid.render('mermaid-svg-unique', result.mermaidCode);
                            if (mermaidRef.current) {
                                mermaidRef.current.innerHTML = svg;
                            }
                        } catch (err) {
                            console.error("Mermaid error:", err);
                        }
                    };
                    renderDiagram();
                }
            }, [result]);

            const callGemini = async (prompt, retries = 5, delay = 1000) => {
                const systemPrompt = `Eres un experto en lógica de programación. Devuelve un JSON con: 
                1. "mermaidCode": Diagrama en Mermaid.js. 
                2. "algorithmSteps": Array de pasos. 
                3. "pythonCode": Código Python funcional.`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { 
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "OBJECT",
                                    properties: {
                                        mermaidCode: { type: "STRING" },
                                        algorithmSteps: { type: "ARRAY", items: { type: "STRING" } },
                                        pythonCode: { type: "STRING" }
                                    },
                                    required: ["mermaidCode", "algorithmSteps", "pythonCode"]
                                }
                            }
                        })
                    });

                    if (!response.ok) throw new Error("Error en la API");
                    const data = await response.json();
                    return JSON.parse(data.candidates[0].content.parts[0].text);
                } catch (err) {
                    if (retries > 0) {
                        await new Promise(r => setTimeout(r, delay));
                        return callGemini(prompt, retries - 1, delay * 2);
                    }
                    throw err;
                }
            };

            const handleGenerate = async () => {
                if (!description.trim()) return;
                setLoading(true);
                setError(null);
                try {
                    const data = await callGemini(description);
                    setResult(data);
                } catch (err) {
                    setError("No se pudo generar el algoritmo. Revisa tu API Key.");
                } finally {
                    setLoading(false);
                }
            };

            const downloadPNG = () => {
                const svg = mermaidRef.current.querySelector('svg');
                if (!svg) return;
                const svgData = new XMLSerializer().serializeToString(svg);
                const canvas = document.createElement("canvas");
                const svgSize = svg.getBoundingClientRect();
                canvas.width = svgSize.width * 2;
                canvas.height = svgSize.height * 2;
                const ctx = canvas.getContext("2d");
                const img = new Image();
                img.onload = () => {
                    ctx.fillStyle = "white";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const link = document.createElement("a");
                    link.download = "diagrama.png";
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                };
                img.src = "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(svgData)));
            };

            const copyCode = () => {
                navigator.clipboard.writeText(result.pythonCode);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-10">
                    <header className="mb-10 flex items-center gap-4">
                        <div className="bg-indigo-600 p-3 rounded-2xl shadow-lg shadow-indigo-100">
                            <Icons.GitBranch />
                        </div>
                        <div>
                            <h1 className="text-3xl font-black text-slate-800">LogicGen Pro</h1>
                            <p className="text-slate-500 font-medium">De lenguaje natural a arquitectura lógica</p>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Entrada */}
                        <div className="lg:col-span-4 space-y-6">
                            <div className="bg-white p-6 rounded-3xl shadow-xl border border-gray-100">
                                <label className="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Descripción</label>
                                <textarea 
                                    className="w-full h-64 p-5 bg-slate-50 border-2 border-transparent rounded-2xl focus:bg-white focus:border-indigo-500 outline-none transition-all text-sm leading-relaxed"
                                    placeholder="Ej: Un programa que reciba una edad y diga si es mayor de edad..."
                                    value={description}
                                    onChange={(e) => setDescription(e.target.value)}
                                />
                                <button 
                                    onClick={handleGenerate}
                                    disabled={loading || !description}
                                    className={`w-full mt-6 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all shadow-xl ${
                                        loading || !description ? 'bg-slate-100 text-slate-300' : 'bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95 shadow-indigo-200'
                                    }`}
                                >
                                    {loading ? "Procesando..." : "Generar Lógica"}
                                </button>
                            </div>
                            {error && (
                                <div className="p-4 bg-red-50 text-red-600 rounded-2xl flex gap-3 text-sm font-bold border-l-4 border-red-500 animate-shake">
                                    <Icons.Alert /> {error}
                                </div>
                            )}
                        </div>

                        {/* Resultados */}
                        <div className="lg:col-span-8 space-y-8">
                            {!result && !loading && (
                                <div className="h-full min-h-[500px] border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center text-slate-300">
                                    <Icons.FileText />
                                    <p className="mt-4 font-bold uppercase text-xs tracking-widest">Esperando instrucciones</p>
                                </div>
                            )}

                            {loading && (
                                <div className="h-full min-h-[500px] bg-white rounded-3xl shadow-sm flex flex-col items-center justify-center animate-pulse">
                                    <div className="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
                                    <p className="mt-6 font-bold text-indigo-900">IA trabajando...</p>
                                </div>
                            )}

                            {result && !loading && (
                                <div className="space-y-8">
                                    {/* Diagrama */}
                                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                        <div className="px-8 py-5 border-b border-slate-50 flex justify-between items-center bg-slate-50/30">
                                            <h2 className="text-xs font-black uppercase tracking-widest text-slate-500">Diagrama de Flujo</h2>
                                            <button onClick={downloadPNG} className="p-2 hover:bg-white rounded-xl text-indigo-600 transition-all">
                                                <Icons.Download />
                                            </button>
                                        </div>
                                        <div className="p-10 flex justify-center mermaid" ref={mermaidRef}></div>
                                    </div>

                                    {/* Pasos y Python */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div className="bg-white rounded-3xl shadow-sm p-8">
                                            <h2 className="text-xs font-black uppercase tracking-widest text-slate-400 mb-6">Algoritmo</h2>
                                            <div className="space-y-4">
                                                {result.algorithmSteps.map((step, i) => (
                                                    <div key={i} className="flex gap-4 items-start">
                                                        <span className="w-6 h-6 bg-slate-100 text-slate-400 text-[10px] font-bold rounded flex items-center justify-center flex-shrink-0">{i+1}</span>
                                                        <p className="text-sm text-slate-600 leading-relaxed">{step}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-slate-900 rounded-3xl shadow-2xl p-8 text-emerald-400 font-mono text-xs relative group">
                                            <h2 className="text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 mb-6">Python Code</h2>
                                            <button onClick={copyCode} className="absolute top-6 right-6 text-slate-600 hover:text-white transition-colors">
                                                {copied ? <Icons.Check /> : <Icons.Copy />}
                                            </button>
                                            <pre className="overflow-x-auto"><code>{result.pythonCode}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


